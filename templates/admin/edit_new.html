{% extends "base.html" %}
{% block link %}
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/add.css') }} ">
{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="form-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h1>

    <form action="/admin/edit_news/{{ new.id }}" method="POST" enctype="multipart/form-data" class="form-contact">
        <div class="form-group">
            <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏</label>
            <input type="text" id="title" name="title" class="form-input"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" value="{{ new.title }}" required>
        </div>

        <div class="form-group">
            <label for="text">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏</label>
            <textarea id="text" name="text" class="form-input"
                      placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏..." rows="6" required>{{ new.text }}</textarea>
        </div>

        <div class="form-group">
            <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–∏</label>

            <!-- –¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            {% if new.image %}
            <div class="current-image">
                <p>–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</p>
                <img src="{{ new.image }}" alt="{{ new.title }}" class="image-preview">
            </div>
        </div>
        {% endif %}

        <div class="file-input-container">
            <label for="file-input" class="file-input-label">
                üìÅ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            </label>
            <input id="file-input" type="file" name="file" accept="image/*">
        </div>
        <div class="file-name" id="file-name">
            {% if new.image %}
            –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: {{ new.image.split('/')[-1] }}
            {% else %}
            –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω
            {% endif %}
        </div>

    <div class="form-actions">
        <button type="submit" class="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        <a href="/admin/news" class="cancel-btn">–û—Ç–º–µ–Ω–∞</a>
    </div>
    </form>
</div>

<script>
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    document.getElementById('file-input').addEventListener('change', function(e) {
        if (e.target.files[0]) {
            document.getElementById('file-name').textContent = '–ù–æ–≤—ã–π —Ñ–∞–π–ª: ' + e.target.files[0].name;
        } else {
            document.getElementById('file-name').textContent = '{% if new.image %}–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: {{ new.image.split("/")[-1] }}{% else %}–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω{% endif %}';
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–∞–ª–æ—á–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
    const keepImageCheckbox = document.querySelector('input[name="keep_image"]');
    if (keepImageCheckbox) {
        keepImageCheckbox.addEventListener('change', function(e) {
            const fileInput = document.getElementById('file-input');
            if (e.target.checked) {
                fileInput.disabled = true;
                document.getElementById('file-name').textContent = '–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: {{ new.image.split("/")[-1] }}';
            } else {
                fileInput.disabled = false;
            }
        });
    }

    // –ü–ª–∞–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
    const form = document.querySelector('.form-contact');
    form.addEventListener('submit', function(e) {
        const inputs = form.querySelectorAll('input[required], textarea[required]');
        let isValid = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                input.style.borderColor = '#e74c3c';
                isValid = false;
            } else {
                input.style.borderColor = '#27ae60';
            }
        });

        if (!isValid) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        }
    });

    // –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞ –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
    const formInputs = document.querySelectorAll('.form-input');
    formInputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.style.borderColor = '#667eea';
        });
    });
</script>
{% endblock %}